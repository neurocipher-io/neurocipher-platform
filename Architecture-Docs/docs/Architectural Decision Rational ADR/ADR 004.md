  

ADR-004 CI CD and Environments

  

  

- Status: Accepted
- Date: 2025-10-23
- Owners: DevEx

  

  

  

Context

  

  

We need safe, repeatable releases with policy checks. No long-lived AWS keys. Preview stacks speed review.

  

  

Decision

  

  

Use GitHub Actions with OIDC to assume AWS roles. Terraform with Terragrunt for IaC. Ephemeral preview per PR. Gated promotion to stg and prod.

  

Pipeline order:

  

1. Lint, type check, unit tests
2. Contract diff and schema validation
3. Build images, SBOM, Trivy and CodeQL
4. Deploy preview stack, run e2e
5. Manual gate to stg, run load and relevance
6. Manual approval to prod, tag and record provenance

  

  

  

Alternatives

  

  

1. Self-hosted runners only
2. AWS CodePipeline
3. Direct apply from laptops

  

  

Rejected due to cost, complexity, or risk.

  

  

Consequences

  

  

- No stored cloud secrets in CI
- Consistent infra across envs
- Extra runtime for previews

  

  

  

Policies

  

  

- Protected main. Feature branches via PR
- Tags vX.Y.Z trigger prod release workflow
- Rollback via versioned Terraform state and image pin

  

  

  

Links

  

  

- .github/workflows/*
- infra/envs/*
- SECURITY.md
- 