id: ADR-003
title: Retrieval Architecture
owner: Search Lead
status: Accepted
last_reviewed: 2025-10-23

ADR-003 Retrieval Architecture

  

  

- Status: Accepted
- Date: 2025-10-23
- Owners: Search Lead

  

  

  

Context

  

  

Users need high recall and precision across mixed modalities. Vector only is not sufficient for lexical matches and filters. Keyword only is weak on semantic similarity.

  

  

Decision

  

  

Use hybrid retrieval with reciprocal rank fusion.

  

- Vector store: Weaviate collections per modality
- Keyword store: OpenSearch Serverless with BM25
- Fusion: RRF with tunable k and weights per query class
- Metadata filters evaluated in both engines then intersected

  

  

  

Alternatives

  

  

1. Vector only
2. Keyword only
3. One engine for both roles

  

  

Rejected due to quality or feature gaps.

  

  

Consequences

  

  

- Better relevance across heterogeneous inputs
- Two systems to operate and monitor
- Indexing pipeline writes to both backends

## Acceptance Criteria

- The query and indexing services are implemented to use Weaviate for vector search and OpenSearch Serverless for keyword search, with both indexes kept in sync for in-scope document types.
- Hybrid retrieval uses reciprocal rank fusion (RRF) with tunable parameters as described in this ADR, and those parameters are configurable per query class.
- Evaluation harnesses and golden sets exist to measure relevance (e.g., Recall@10 and latency SLIs), and results meet or exceed the targets in this ADR.
- Operational dashboards expose hybrid retrieval SLIs (recall, latency, freshness) and error rates, and alerts are wired in line with OBS-002/OBS-003.
- Changes to the retrieval architecture (e.g., consolidating engines or changing fusion strategy) are recorded in a new ADR that supersedes or extends ADR-003.

  

  

  

SLIs

  

  

- Recall@10 target 0.9 on golden set
- p95 query latency 900 ms uncached
- Freshness lag under 5 minutes streaming

  

  

  

Links

  

  

- services/index/
- services/api/handlers/query.py
- tools/eval/